<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">

<dom-module id="iron-star-rating">
    <template>
        <style>
            :host {
                display: inline-block;
                cursor: pointer;
                --iron-icon-width: var(--star-rating-size, 24px);
                --iron-icon-height: var(--star-rating-size, 24px);
            }
            :host[hidden] {
                display: none !important;
            }
            iron-icon {
                color: #eeeeee;
                float: right;
            }
            iron-icon.whole {
                -webkit-clip-path: inset(0 0 0 50%);
                   -moz-clip-path: inset(0 0 0 50%);
                    -ms-clip-path: inset(0 0 0 50%);
                     -o-clip-path: inset(0 0 0 50%);
                        clip-path: inset(0 0 0 50%);
                position: relative;
                left: calc(var(--iron-icon-width) * -1);
                margin-right: calc(var(--iron-icon-width) * -1);
            }
            iron-icon.half {
                -webkit-clip-path: inset(0 50% 0 0);
                   -moz-clip-path: inset(0 50% 0 0);
                    -ms-clip-path: inset(0 50% 0 0);
                     -o-clip-path: inset(0 50% 0 0);
                        clip-path: inset(0 50% 0 0);
                position: relative;
            }
            iron-icon.active,
            iron-icon.active ~ iron-icon {
                color: #fdd835;
            }
            iron-icon:hover,
            iron-icon:hover ~ iron-icon {
                color: #ffeb3b !important;
            }
        </style>
    
        <iron-icon icon="icons:star" class="whole" data-rating="5"></iron-icon>
        <iron-icon icon="icons:star" class="half" data-rating="4.5"></iron-icon>
        <iron-icon icon="icons:star" class="whole" data-rating="4"></iron-icon>
        <iron-icon icon="icons:star" class="half" data-rating="3.5"></iron-icon>
        <iron-icon icon="icons:star" class="whole" data-rating="3"></iron-icon>
        <iron-icon icon="icons:star" class="half" data-rating="2.5"></iron-icon>
        <iron-icon icon="icons:star" class="whole" data-rating="2"></iron-icon>
        <iron-icon icon="icons:star" class="half" data-rating="1.5"></iron-icon>
        <iron-icon icon="icons:star" class="whole" data-rating="1"></iron-icon>
        <iron-icon icon="icons:star" class="half" data-rating="0.5"></iron-icon>
    </template>

    <script>
        /**
        * `iron-star-rating`
        * 5-star rating element (Polymer 2.x)
        *
        * @customElement
        * @polymer
        * @demo demo/index.html
        */
        class IronStarRating extends Polymer.Element {
            static get is() { return 'iron-star-rating'; }
            static get properties() {
                return {
                    value: {
                        type: Number,
                        notify: true,
                        value: 'iron-star-rating',
                        observer: '_valueChanged'
                    }
                };
            }

            ready() {
                super.ready();

                var self = this;
                var stars = Polymer.dom(this.root).querySelectorAll('iron-icon');
                stars.forEach(function(star) {
                    star.addEventListener('click', e => self._starClicked(e));
                });
            }

            _valueChanged(newValue, oldValue) {
                if (newValue !== 0 && !newValue) {
                    return;
                }
                var stars = Polymer.dom(this.root).querySelectorAll('iron-icon');
                stars.forEach(function(star) {
                    if (star.dataset.rating === newValue.toString()) {
                        star.classList.add('active');
                    } else {
                        star.classList.remove('active');
                    }
                });
            }

            _starClicked(e) {
                e.preventDefault();

                this.value = e.target.dataset.rating;
                this.dispatchEvent(new CustomEvent('iron-star-rating-changed', {detail: {rating: this.value}}));
            }
        }

        window.customElements.define(IronStarRating.is, IronStarRating);
    </script>
</dom-module>
